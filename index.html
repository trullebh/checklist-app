
<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Checklist STRAP – App</title>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<style>
:root{
  --bg:#f3f4f6; --card:#ffffff; --muted:#6b7280; --accent:#2563eb; --accent-2:#10b981;
  --surface:#e5e7eb; --danger:#ef4444; --glass:rgba(255,255,255,0.6);
}
[data-theme="dark"]{
  --bg:#0b1220; --card:#0f1724; --muted:#9ca3af; --accent:#60a5fa; --accent-2:#34d399;
  --surface:#111827; --danger:#f87171; --glass:rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{
  margin:0; font-family: Inter, "Segoe UI", Roboto, Arial; background:var(--bg); color:var(--muted);
  -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
}
.app{
  display:flex; min-height:100vh;
}
/* Sidebar */
.sidebar{
  width:280px; background:linear-gradient(180deg,var(--card),var(--glass));
  padding:18px; border-right:1px solid rgba(0,0,0,0.06);
}
.brand{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
.logo{
  width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent-2));
  display:flex;align-items:center;justify-content:center;color:white;font-weight:700;
  box-shadow:0 6px 18px rgba(37,99,235,0.12);
}
.title{font-weight:700;color:var(--muted);font-size:16px}
.small{font-size:12px;color:var(--muted);opacity:0.9}

/* Nav */
.nav{margin-top:14px;display:flex;flex-direction:column;gap:8px}
.nav button{
  display:flex;align-items:center;gap:10px;padding:10px;border-radius:8px;border:0;background:transparent;color:var(--muted);
  cursor:pointer;font-weight:600;text-align:left;
}
.nav button.active{background:var(--surface);box-shadow:inset 0 0 0 1px rgba(0,0,0,0.03)}
.sep{height:1px;background:linear-gradient(90deg,transparent,var(--surface),transparent);margin:12px 0;border-radius:4px}

/* Main */
.main{flex:1;padding:24px;overflow:auto}
.header{display:flex;justify-content:space-between;align-items:center;gap:12px}
.controls{display:flex;align-items:center;gap:10px}
.btn{
  padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:white;font-weight:700;cursor:pointer;
}
.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06);color:var(--muted);font-weight:600}

/* Layout */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:18px}
.card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.04);color:var(--muted)}
.card h3{margin:0 0 8px 0;color:var(--muted)}
.progressbar{height:12px;background:#e6e9ee;border-radius:8px;overflow:hidden}
.progress{height:12px;background:var(--accent-2);width:0%}

/* Projects list */
.projects{margin-top:12px;display:flex;flex-direction:column;gap:8px}
.project-row{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;background:var(--surface)}
.project-row .meta{display:flex;gap:10px;align-items:center}
.kv{font-size:12px;color:var(--muted)}

/* Checklist area */
.checklist-wrap{margin-top:16px;display:flex;gap:18px}
.left{flex:2}
.right{flex:1}
.section{margin-bottom:12px}
.section h4{margin:6px 0 8px 0;color:var(--muted)}
.task{display:flex;align-items:center;gap:10px;padding:8px;border-radius:8px;background:linear-gradient(0deg,transparent,transparent);margin-bottom:6px}
.task input[type="checkbox"]{width:18px;height:18px}
.task .ttext{font-weight:600;color:var(--muted);font-size:14px}
.smalltxt{font-size:12px;color:var(--muted)}

/* Forms */
.form-row{display:flex;gap:8px;align-items:center;margin-top:8px}
.input,select{padding:8px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);background:transparent;color:var(--muted);min-width:0}
.input{flex:1}

/* Footer */
.footer{margin-top:18px;font-size:13px;color:var(--muted)}

/* Responsive */
@media(max-width:900px){
  .sidebar{display:none}
  .grid{grid-template-columns:1fr}
  .checklist-wrap{flex-direction:column}
}
</style>
</head>
<body>
<div class="app" id="app" data-theme="light">
  <aside class="sidebar">
    <div class="brand">
      <div class="logo">S</div>
      <div>
        <div class="title">Checklist STRAP</div>
        <div class="small">Gerenciador de projetos</div>
      </div>
    </div>

    <div class="nav">
      <button id="nav-dashboard" class="active" onclick="showPane('dashboard')">Dashboard</button>
      <button id="nav-projects" onclick="showPane('projects')">Projetos</button>
      <button id="nav-checklist" onclick="showPane('checklist')">Checklist</button>
      <button id="nav-settings" onclick="showPane('settings')">Configurações</button>
    </div>

    <div class="sep"></div>

    <div style="display:flex;gap:8px;align-items:center;justify-content:space-between">
      <div style="display:flex;flex-direction:column">
        <div class="small">Tema</div>
        <div class="smalltxt" id="currentTheme">Claro</div>
      </div>
      <button id="themeToggle" class="ghost" onclick="toggleTheme()">Alternar</button>
    </div>

    <div class="sep"></div>

    <div style="margin-top:12px">
      <div class="small">Criar novo projeto</div>
      <div class="form-row">
        <input id="newProjectName" class="input" placeholder="Nome do projeto">
        <button class="btn" onclick="createProject()">Criar</button>
      </div>
      <div class="smalltxt" style="margin-top:8px">Categoria</div>
      <div class="form-row">
        <select id="newProjectCategory" class="input"></select>
        <button class="ghost" onclick="openCreateCategory()">+</button>
      </div>
    </div>

  </aside>

  <main class="main">
    <div id="pane-dashboard">
      <div class="header">
        <h2>Dashboard</h2>
        <div class="controls">
          <button class="ghost" onclick="exportAll()">Exportar</button>
          <button class="ghost" onclick="importAll()">Importar</button>
          <button class="btn" onclick="showPane('projects')">Ver Projetos</button>
        </div>
      </div>

      <div class="grid">
        <div class="card">
          <h3>Projetos</h3>
          <div id="cardProjects" class="kv">0 projetos</div>
        </div>
        <div class="card">
          <h3>Progresso médio</h3>
          <div class="progressbar" style="margin-top:8px"><div id="avgProgress" class="progress"></div></div>
          <div class="smalltxt" id="avgLabel" style="margin-top:8px">0%</div>
        </div>
        <div class="card">
          <h3>Resumo por categoria</h3>
          <div id="categorySummary" style="margin-top:8px"></div>
        </div>
      </div>

      <div class="card" style="margin-top:18px">
        <h3>Projetos recentes</h3>
        <div id="recentProjects" class="projects"></div>
      </div>
    </div>

    <div id="pane-projects" style="display:none">
      <div class="header">
        <h2>Projetos</h2>
        <div class="controls">
          <input id="filterText" class="input" placeholder="Buscar...">
          <button class="ghost" onclick="loadProjects()">Atualizar</button>
        </div>
      </div>

      <div id="projectsList" class="projects" style="margin-top:12px"></div>
    </div>

    <div id="pane-checklist" style="display:none">
      <div class="header">
        <h2 id="checklistTitle">Checklist</h2>
        <div class="controls">
          <button class="ghost" onclick="addTaskUI()">➕ Tarefa</button>
          <button class="ghost" onclick="addCategoryUI()">➕ Categoria</button>
          <button class="btn" onclick="saveCurrent()">Salvar</button>
        </div>
      </div>

      <div class="checklist-wrap">
        <div class="left card" id="checklistArea"></div>
        <div class="right card">
          <h3>Resumo</h3>
          <div class="smalltxt">Progresso do projeto</div>
          <div class="progressbar" style="margin-top:8px"><div id="projectProgress" class="progress"></div></div>
          <div id="progressLabel" class="smalltxt" style="margin-top:8px">0%</div>

          <div style="margin-top:12px">
            <h4>Metadados</h4>
            <div class="smalltxt">Nome: <span id="metaName"></span></div>
            <div class="smalltxt">Categoria: <span id="metaCategory"></span></div>
            <div style="margin-top:8px">
              <button class="ghost" onclick="renameProject()">Renomear</button>
              <button class="ghost" onclick="changeCategory()">Mudar categoria</button>
              <button class="ghost" style="background:var(--danger);color:white" onclick="deleteProject()">Excluir</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">Dica: Clique nas tarefas para marcar como concluídas. Você pode adicionar/excluir categorias e tarefas livremente.</div>
    </div>

    <div id="pane-settings" style="display:none">
      <h2>Configurações</h2>
      <div class="card" style="margin-top:12px">
        <h3>Categorias</h3>
        <div id="categoryList"></div>
        <div class="form-row" style="margin-top:12px">
          <input id="newCategoryName" class="input" placeholder="Nova categoria">
          <button class="btn" onclick="createCategory()">Criar</button>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h3>Deploy</h3>
        <p class="smalltxt">Para subir para a nuvem (GitHub Pages) siga estes passos:</p>
        <ol class="smalltxt">
          <li>Crie um repositório no GitHub.</li>
          <li>Faça upload deste arquivo <b>checklist_site.html</b> (o único arquivo necessário).</li>
          <li>Vá em Settings → Pages e selecione a branch <b>main</b> e a pasta <b>/ (root)</b>.</li>
          <li>Salve. Em alguns minutos o site estará disponível em <i>https://seu-usuario.github.io/seu-repo</i>.</li>
        </ol>
        <p class="smalltxt">Quer que eu gere um ZIP pronto para upload com instruções? Peça que eu gere.</p>
      </div>

    </div>

  </main>
</div>

<script>
/* App data structure in localStorage:
strapSite = {
  projects: {
    "Project name": { meta: {category, created}, tasks: { "Section::Task": true/false }, customSections: {section: [tasks...] } }
  },
  categories: ["Default", "Complexo"]
}
*/

const defaultSections = {
  "Preparação do Modelo": [
    "Definir o unifilar",
    "Lançar os tipos de perfis",
    "Corrigir a orientação dos perfis",
    "Articular barras rotuladas",
    "Contraventamentos trabalhando apenas à tração"
  ],
  "Determinar Vistas": [
    "Vista 3D",
    "Eixos",
    "Filas",
    "Elevações",
    "Marcas de eixo (se aplicável)",
    "Cotas (se aplicável)"
  ],
  "Condições de Contorno": ["Aplicar apoios","Ligações rígidas (se aplicável)"],
  "Carregamentos": ["Lançar carregamentos (peso próprio +10%)","Configurar padrões","Configurar carregamentos de serviço","Definir combinações"],
  "Verificações": ["Verificação da deformada","Verificação dos diagramas de esforços","Verificação das reações de apoio","Combinar barras contínuas","Inserir travamentos de FLB","Inserir travamentos de FLT"],
  "Configurações do Projeto": ["Configurar parâmetros","Definir barras idênticas"],
  "Dimensionamento": ["Dimensionar estrutura e atualizar geometria"],
  "Ligações": ["Criar e verificar ligações no IDEA Statica (se aplicável)"]
};

function getStore(){
  return JSON.parse(localStorage.getItem('strapSite') || '{}');
}
function saveStore(s){ localStorage.setItem('strapSite', JSON.stringify(s)); }

function ensureInit(){
  const s = getStore();
  if(!s.categories) s.categories = ["Geral","Estrutural"];
  if(!s.projects) s.projects = {};
  if(!s.defaultSections) s.defaultSections = defaultSections;
  saveStore(s);
}
ensureInit();

/* NAV */
function showPane(name){
  document.querySelectorAll('[id^="pane-"]').forEach(p=>p.style.display='none');
  document.getElementById('pane-'+name).style.display='block';
  document.querySelectorAll('.nav button').forEach(b=>b.classList.remove('active'));
  document.getElementById('nav-'+name).classList.add('active');
  if(name==='dashboard') renderDashboard();
  if(name==='projects') loadProjects();
  if(name==='checklist') {
    // nothing
  }
}

/* THEME */
function toggleTheme(){
  const el = document.getElementById('app');
  const current = el.getAttribute('data-theme');
  const nxt = current==='light' ? 'dark' : 'light';
  el.setAttribute('data-theme', nxt);
  document.getElementById('currentTheme').innerText = nxt==='light'?'Claro':'Escuro';
}

/* CATEGORIES */
function loadCategories(){
  const s = getStore();
  const sel = document.getElementById('newProjectCategory');
  sel.innerHTML = '';
  s.categories.forEach(c=>{
    const opt = document.createElement('option'); opt.value=c; opt.innerText=c; sel.appendChild(opt);
  });
  const list = document.getElementById('categoryList'); list.innerHTML='';
  s.categories.forEach(c=>{
    const div=document.createElement('div'); div.className='project-row';
    div.innerHTML = `<div class="meta">${c}</div><div><button class="ghost" onclick="deleteCategory('${c}')">Excluir</button></div>`;
    list.appendChild(div);
  });
}
function createCategory(){
  const name = document.getElementById('newCategoryName').value.trim();
  if(!name) return alert('Nome inválido');
  const s=getStore(); if(!s.categories.includes(name)) s.categories.push(name);
  saveStore(s); loadCategories(); document.getElementById('newCategoryName').value='';
}
function openCreateCategory(){ document.getElementById('newCategoryName').focus(); }
function deleteCategory(name){
  if(!confirm('Excluir categoria "'+name+'"? Essa ação não removerá projetos.')) return;
  const s=getStore(); s.categories = s.categories.filter(c=>c!==name); saveStore(s); loadCategories();
}

/* PROJECTS */
let currentProject = null;

function createProject(){
  const name = document.getElementById('newProjectName').value.trim();
  if(!name) return alert('Digite um nome de projeto');
  const s=getStore();
  if(s.projects[name]) return alert('Já existe projeto com esse nome');
  const category = document.getElementById('newProjectCategory').value || s.categories[0];
  s.projects[name] = { meta:{category:category, created:new Date().toISOString()}, tasks:{}, customSections:{} };
  // initialize tasks from defaultSections
  Object.entries(s.defaultSections).forEach(([sec,arr])=>{
    arr.forEach(t=> s.projects[name].tasks[sec+'::'+t] = false);
  });
  saveStore(s);
  document.getElementById('newProjectName').value='';
  loadProjects(); showPane('checklist'); openProject(name);
}
function loadProjects(){
  const s=getStore();
  const list = document.getElementById('projectsList');
  const recent = document.getElementById('recentProjects');
  list.innerHTML=''; recent.innerHTML='';
  const entries = Object.entries(s.projects).sort((a,b)=> new Date(b[1].meta.created) - new Date(a[1].meta.created));
  document.getElementById('cardProjects').innerText = entries.length + ' projetos';
  entries.forEach(([name,data])=>{
    const row=document.createElement('div'); row.className='project-row';
    const meta=document.createElement('div'); meta.className='meta';
    meta.innerHTML = `<div><strong>${name}</strong><div class="kv">${data.meta.category}</div></div>`;
    const actions=document.createElement('div');
    const pct = projectProgressValue(data);
    actions.innerHTML = `<button class="ghost" onclick="openProject('${name}')">Abrir</button>
                         <button class="ghost" onclick="exportProject('${name}')">Export</button>
                         <button class="ghost" onclick="duplicateProject('${name}')">Duplicar</button>
                         <button class="ghost" style="background:var(--danger);color:white" onclick="deleteProjectName('${name}')">Excluir</button>`;
    row.appendChild(meta); row.appendChild(actions);
    list.appendChild(row);

    // recent
    const rec=document.createElement('div'); rec.className='project-row';
    rec.innerHTML = `<div><strong>${name}</strong><div class="kv">${Math.round(pct)}% • ${data.meta.category}</div></div>
                     <div><button class="ghost" onclick="openProject('${name}')">Abrir</button></div>`;
    recent.appendChild(rec);
  });
  loadCategories(); renderDashboard();
}

function openProject(name){
  currentProject = name;
  const s=getStore();
  const project = s.projects[name];
  if(!project) return alert('Projeto não encontrado');
  document.getElementById('checklistTitle').innerText = name;
  document.getElementById('metaName').innerText = name;
  document.getElementById('metaCategory').innerText = project.meta.category;
  generateChecklistUI(project);
  showPane('checklist');
}

function deleteProjectName(name){
  if(!confirm('Excluir projeto "'+name+'"?')) return;
  const s=getStore(); delete s.projects[name]; saveStore(s); loadProjects();
}

function deleteProject(){
  if(!currentProject) return;
  if(!confirm('Excluir projeto "'+currentProject+'"? Esta ação não pode ser desfeita.')) return;
  const s=getStore(); delete s.projects[currentProject]; saveStore(s); currentProject=null; loadProjects(); showPane('dashboard');
}

function duplicateProject(name){
  const s=getStore(); const orig = s.projects[name];
  const newName = name + ' (cópia)';
  s.projects[newName] = JSON.parse(JSON.stringify(orig));
  s.projects[newName].meta.created = new Date().toISOString();
  saveStore(s); loadProjects();
}

/* Checklist UI */
function generateChecklistUI(project){
  const area = document.getElementById('checklistArea'); area.innerHTML='';
  // show default sections then custom
  const sections = Object.assign({}, getStore().defaultSections, project.customSections || {});
  Object.entries(sections).forEach(([section,tasks])=>{
    const secDiv = document.createElement('div'); secDiv.className='section';
    secDiv.innerHTML = `<h4>${section} <button class="ghost" style="margin-left:8px" onclick="addTaskToSectionPrompt('${section}')">+ tarefa</button> <button class="ghost" onclick="deleteSection('${section}')">Excluir seção</button></h4>`;
    tasks.forEach(t=>{
      const id = section + '::' + t;
      const checked = project.tasks[id];
      const taskDiv = document.createElement('div'); taskDiv.className='task';
      taskDiv.innerHTML = `<input type="checkbox" ${checked ? 'checked':''} onchange="toggleTask('${id}',this.checked)">
                           <div class="ttext">${t}</div>
                           <div style="margin-left:auto"><button class="ghost" onclick="removeTask('${section}','${t}')">Excluir</button></div>`;
      secDiv.appendChild(taskDiv);
    });
    area.appendChild(secDiv);
  });
  updateProjectProgressUI();
}

/* Tasks and sections operations */
function toggleTask(id, val){
  const s=getStore(); if(!currentProject) return;
  s.projects[currentProject].tasks[id] = !!val; saveStore(s); updateProjectProgressUI(); renderDashboard();
}
function removeTask(section, task){
  if(!confirm('Excluir tarefa?')) return;
  const s=getStore(); const proj = s.projects[currentProject];
  // remove from tasks map
  delete proj.tasks[section+'::'+task];
  // remove from customSections or defaultSections copy
  if(proj.customSections && proj.customSections[section]){
    proj.customSections[section] = proj.customSections[section].filter(t=>t!==task);
    if(proj.customSections[section].length===0) delete proj.customSections[section];
  } else {
    // if it's default, mark removal by adding a flag in project to skip (simple approach: add negative flag)
    // we'll just remove from default rendering by adding empty customSections override
    proj.customSections = proj.customSections || {};
    proj.customSections[section] = (proj.customSections[section] || getStore().defaultSections[section] || []).filter(t=>t!==task);
  }
  saveStore(s); generateChecklistUI(proj);
}
function addTaskToSectionPrompt(section){
  const t = prompt('Nome da nova tarefa em "'+section+'":');
  if(!t) return;
  addTaskToSection(section, t);
}
function addTaskToSection(section, task){
  const s=getStore(); const proj = s.projects[currentProject];
  proj.customSections = proj.customSections || {};
  if(!proj.customSections[section]) proj.customSections[section] = (getStore().defaultSections[section] || []).slice();
  proj.customSections[section].push(task);
  proj.tasks[section+'::'+task] = false;
  saveStore(s); generateChecklistUI(proj);
}
function addTaskUI(){
  const section = prompt('Em qual seção quer adicionar a tarefa? (digite o nome exato ou crie nova seção)');
  if(!section) return;
  const task = prompt('Nome da tarefa:');
  if(!task) return;
  // ensure section exists in customSections
  const s=getStore(); const proj = s.projects[currentProject];
  proj.customSections = proj.customSections || {};
  proj.customSections[section] = proj.customSections[section] || [];
  proj.customSections[section].push(task);
  proj.tasks[section+'::'+task] = false;
  saveStore(s); generateChecklistUI(proj);
}
function addCategoryUI(){
  const name = prompt('Nome da nova categoria:');
  if(!name) return;
  const s=getStore(); if(!s.categories.includes(name)) s.categories.push(name);
  saveStore(s); loadCategories();
}
function deleteSection(section){
  if(!confirm('Excluir seção "'+section+'"?')) return;
  const s=getStore(); const proj = s.projects[currentProject];
  // remove tasks belonging to section
  Object.keys(proj.tasks).forEach(k => { if(k.startsWith(section+'::')) delete proj.tasks[k]; });
  // remove customSections entry
  if(proj.customSections && proj.customSections[section]) delete proj.customSections[section];
  saveStore(s); generateChecklistUI(proj);
}

/* Project progress */
function projectProgressValue(project){
  const keys = Object.keys(project.tasks || {});
  if(keys.length===0) return 0;
  const done = keys.filter(k=>project.tasks[k]).length;
  return (done/keys.length)*100;
}
function updateProjectProgressUI(){
  const s=getStore(); if(!currentProject) return;
  const proj = s.projects[currentProject];
  const val = projectProgressValue(proj);
  document.getElementById('projectProgress').style.width = Math.round(val)+'%';
  document.getElementById('progressLabel').innerText = Math.round(val)+'%';
  document.getElementById('metaName').innerText = currentProject;
  document.getElementById('metaCategory').innerText = proj.meta.category;
}
function renderDashboard(){
  const s=getStore();
  const entries = Object.entries(s.projects);
  const avg = entries.length ? Math.round(entries.reduce((acc,[n,p])=>acc+projectProgressValue(p),0)/entries.length) : 0;
  document.getElementById('avgProgress').style.width = avg+'%';
  document.getElementById('avgLabel').innerText = avg+'%';
  // category summary
  const summary = {};
  entries.forEach(([n,p])=>{ const c=p.meta.category||'Geral'; summary[c]=summary[c]||{count:0,acc:0}; summary[c].count++; summary[c].acc+=projectProgressValue(p); });
  const cont = document.getElementById('categorySummary'); cont.innerHTML='';
  Object.entries(summary).forEach(([c,v])=>{
    const pct = Math.round(v.acc/v.count);
    const div = document.createElement('div'); div.className='smalltxt';
    div.innerText = `${c}: ${v.count} projetos • ${pct}% médio`;
    cont.appendChild(div);
  });
  // recent handled in loadProjects
}

/* Save & export */
function saveCurrent(){
  if(!currentProject) return alert('Abra um projeto');
  const s=getStore(); saveStore(s); alert('Salvo!');
  loadProjects();
}
function exportProject(name){
  const s=getStore();
  const data = s.projects[name];
  if(!data) return alert('Projeto não encontrado');
  const blob = new Blob([JSON.stringify({name:name,project:data},null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download = name.replace(/\s+/g,'_') + '.strap.json'; a.click();
}
function exportAll(){
  const s=getStore();
  const blob = new Blob([JSON.stringify(s,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download = 'strap_all_export.json'; a.click();
}
function importAll(){
  const input = document.createElement('input'); input.type='file'; input.accept='.json';
  input.onchange = e => {
    const file = e.target.files[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try{
        const data = JSON.parse(ev.target.result);
        if(data.projects || data.categories){
          localStorage.setItem('strapSite', JSON.stringify(data));
        } else if(data.project && data.name){
          const s = getStore(); s.projects[data.name] = data.project; saveStore(s);
        } else {
          throw new Error('Formato inválido');
        }
        alert('Importado com sucesso'); loadProjects();
      } catch(err){ alert('Erro ao importar: '+err.message); }
    };
    reader.readAsText(file);
  };
  input.click();
}

/* helpers */
function openProject(name){
  currentProject = name;
  const s=getStore(); const proj = s.projects[name];
  if(!proj) return alert('Projeto não encontrado');
  document.getElementById('checklistTitle').innerText = name;
  document.getElementById('metaName').innerText = name;
  document.getElementById('metaCategory').innerText = proj.meta.category;
  generateChecklistUI(proj);
  showPane('checklist');
}
function renameProject(){
  const n = prompt('Novo nome:', currentProject); if(!n) return;
  const s=getStore(); s.projects[n] = s.projects[currentProject]; s.projects[n].meta.created = new Date().toISOString(); delete s.projects[currentProject]; saveStore(s); currentProject = n; loadProjects(); openProject(n);
}
function changeCategory(){
  const s=getStore(); const cat = prompt('Nova categoria:', s.projects[currentProject].meta.category); if(!cat) return;
  s.projects[currentProject].meta.category = cat; if(!s.categories.includes(cat)) s.categories.push(cat); saveStore(s); loadProjects(); openProject(currentProject);
}

/* init */
loadCategories(); loadProjects();
showPane('dashboard');
</script>
</body>
</html>
